<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Timeline</title>
	<style>
	.body{
		display:flex;
		justify-content: space-between;
		flex-direction:column;
	}
	.postTemplate {  
		display: flex;
	  	gap: 1rem;
	  	padding: 1rem;
		flex-direction: column;
		background-color:black;
		border-radius: 20px;
		background-color: #242526;
		min-height: 450px;
		margin-bottom: 50px;
	}
	.spotifyTemplate {
		flex: 1;
		border-radius: 10px;
		flex-basis: auto;
		background-color: lightgray;
		padding: 16px;
		display: flex;
		justify-content: space-between;
		flex-direction: column;
	}
	.photoTemplate {
		border-radius: 10px;
		flex-basis: auto;
		flex: 1;
		background-color: black;
		min-height: 45px;
		max-width: 120px;
	}
	.textTemplate {
		flex: 3;
		height: 250px;
	}
	.footerTemplate {
		flex: 0;
		display: flex;
		justify-content: space-between;
		flex-direction: row;
		height: 10px;
	}
	.reactionsTemplate{
		border-radius: 10px;
		flex-basis: auto;
		background-color: #808080;
		color:#808080;
		user-select: none;
	}
	.commentsTemplate{
		border-radius: 10px;
		flex-basis: auto;
		background-color: #D3D3D3;
		color:#D3D3D3;
		user-select: none;
	  	font-family: 'Roboto', sans-serif;
	}
	</style> <!-- for the templates -->
	<style> 
	.post {  
		display: flex;
  	gap: 1rem;
  	padding: 1rem;

		flex-direction: column;
		background-color:black;
		border-radius: 20px;
		background-color: #242526;
		min-height: 450px;
		margin-bottom: 50px;
	}
	.spotify {
		flex-basis: auto;
		flex: 0;
	}
	.text {
		min-height: 250px;
		max-height: 250px;
		overflow: hidden;
		cursor: pointer;
		transition: max-height 0.2s ease-out;
		flex: 1;
		align-content: left; 
		color: lightgray;
	  font-family: 'Roboto', sans-serif;
    -webkit-mask-image: linear-gradient(180deg, #000 60%, transparent); 
	}
	.footer {
		display: flex;
		justify-content: space-between;
		flex-direction: row;
		flex: 1;
	}
	.reactions{
	}
	.comments{
		color: gray;
	  font-family: 'Roboto', sans-serif;

	}
	</style> <!-- for the actual posts -->
 	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet"> 
</head>
<body>
	<div class="body"></div>
	
	<script>
	const getRandomColor = () => {
    return `rgb(${Math.floor(Math.random() * 256)}, ${Math.floor(Math.random() * 256)}, ${Math.floor(Math.random() * 256)})`;
  }; //gets a random colour
  	const pSBC=(p,c0,c1,l)=>{
    let r,g,b,P,f,t,h,i=parseInt,m=Math.round,a=typeof(c1)=="string";
    if(typeof(p)!="number"||p<-1||p>1||typeof(c0)!="string"||(c0[0]!='r'&&c0[0]!='#')||(c1&&!a))return null;
    if(!this.pSBCr)this.pSBCr=(d)=>{
        let n=d.length,x={};
        if(n>9){
            [r,g,b,a]=d=d.split(","),n=d.length;
            if(n<3||n>4)return null;
            x.r=i(r[3]=="a"?r.slice(5):r.slice(4)),x.g=i(g),x.b=i(b),x.a=a?parseFloat(a):-1
        }else{
            if(n==8||n==6||n<4)return null;
            if(n<6)d="#"+d[1]+d[1]+d[2]+d[2]+d[3]+d[3]+(n>4?d[4]+d[4]:"");
            d=i(d.slice(1),16);
            if(n==9||n==5)x.r=d>>24&255,x.g=d>>16&255,x.b=d>>8&255,x.a=m((d&255)/0.255)/1000;
            else x.r=d>>16,x.g=d>>8&255,x.b=d&255,x.a=-1
        }return x};
    h=c0.length>9,h=a?c1.length>9?true:c1=="c"?!h:false:h,f=this.pSBCr(c0),P=p<0,t=c1&&c1!="c"?this.pSBCr(c1):P?{r:0,g:0,b:0,a:-1}:{r:255,g:255,b:255,a:-1},p=P?p*-1:p,P=1-p;
    if(!f||!t)return null;
    if(l)r=m(P*f.r+p*t.r),g=m(P*f.g+p*t.g),b=m(P*f.b+p*t.b);
    else r=m((P*f.r**2+p*t.r**2)**0.5),g=m((P*f.g**2+p*t.g**2)**0.5),b=m((P*f.b**2+p*t.b**2)**0.5);
    a=f.a,t=t.a,f=a>=0||t>=0,a=f?a<0?t:t<0?a:a*P+t*p:0;
    if(h)return"rgb"+(f?"a(":"(")+r+","+g+","+b+(f?","+m(a*1000)/1000:"")+")";
    else return"#"+(4294967296+r*16777216+g*65536+b*256+(f?m(a*255):0)).toString(16).slice(1,f?undefined:-2)
	} //converts lots of different ways of representing colours to hex
	
	window.addEventListener('scroll', () => {
		const { scrollTop, scrollHeight, clientHeight } = document.documentElement;

		if(clientHeight + scrollTop + 5	>= scrollHeight) {
			addPost();
		}
	}); //calls addPost when the user gets to the bottom of the page
	function addPost() {
		const postElement = document.createElement('div');
		postElement.classList.add('postTemplate');
		postElement.innerHTML = `
		<div class = "spotifyTemplate"">
			<div class = "photoTemplate" style="height:100%;"></div>
		</div>
	  	<div id="textTemplate" class="textTemplate"></div>
		<div class = "footerTemplate">
				<div class = "reactionsTemplate">................</div>
				<div class = "commentsTemplate">Comments</div>
		</div>
	`;
		arrayOfPlaceholders.push(postElement)
		const randomColorOne = getRandomColor();
		spotifyColours.push(randomColorOne);
		postElement.getElementsByClassName('spotifyTemplate')[0].style.backgroundColor = randomColorOne;
		postElement.getElementsByClassName('photoTemplate')[0].style.backgroundColor = pSBC( -.8, randomColorOne);
		container.appendChild(postElement);
	} //creates a template at the bottom of the page
	function loadPost() {
		const postElement = document.createElement('div');
		postElement.classList.add('post');
		postElement.innerHTML = `
		<div class = "spotify">
			<iframe src="https://open.spotify.com/embed/track/0ZfEeIu7CNHQhbCTiVv3cx" width="100%" height="100%"  frameborder="0" allowtransparency="true" allow="encrypted-media"></iframe>
		</div>
	  	<div id="text" class="text">
	  		Lorem  ipsum dolor sit amet, consectetur adipiscing elit. Cras id lacus non purus malesuada hendrerit. Morbi aliquet vel lorem at vulputate. Mauris ex nisi, ornare eu ligula non, lobortis dapibus nisi. Donec eu volutpat lacus. Phasellus leo lacus, sodales id tempus vel, tincidunt vitae justo. Sed non rutrum sapien, vitae convallis augue. Morbi felis justo, laoreet sed elit vel, placerat fringilla velit. Quisque purus dui, ullamcorper eget suscipit eget, finibus nec ex. Phasellus tempor fringilla magna eget imperdiet. Sed viverra diam sit amet erat venenatis volutpat. Praesent suscipit enim sit amet lobortis viverra. Donec vitae faucibus sapien. Sed elementum magna in lectus accumsan ullamcorper id eget leo. Maecenas porttitor ligula at laoreet lobortis.
	  		<br><br>
				Donec quis ultrices nibh. Fusce blandit mi ut ex ultrices, vitae pellentesque lorem finibus. Integer iaculis varius fermentum. Mauris a urna nibh. Nullam efficitur pretium eros nec gravida. Pellentesque sodales ex dolor, sit amet pharetra leo porta at. Quisque molestie mollis enim, et rhoncus dui imperdiet at. Maecenas commodo ligula eu elit bibendum auctor. Cras ultrices accumsan varius. Aliquam erat volutpat. Morbi mattis lacus vitae est posuere pellentesque. Vivamus egestas quis mauris a efficitur. Nulla fringilla nulla ligula, luctus interdum quam congue ut. Nulla et mauris eget urna consequat euismod ut eu metus. Nullam a mollis massa.
		</div>
		<div class = "footer">
				<div class = "reactions">ðŸ˜ŽðŸ‘€ðŸ¤—</div>
				<div class = "comments">Comments</div>
		</div>
	`;
		arrayOfPosts.push(postElement);
		expandedPosts.push(false);
		postElement.addEventListener('click', clickOnText);

		return (postElement);
	} //returns a post
	function breatheColour() {
		if (pos == 1) {
			change += 0.01;
		} else {
			change -= 0.01;
		}
	    if (Math.abs(change) >= 0.08) {
	    	pos = -pos;
	    } 

	    for (var i = 0; i < arrayOfPlaceholders.length; i++) {
			arrayOfPlaceholders[i].getElementsByClassName('spotifyTemplate')[0].style.backgroundColor = pSBC(change, spotifyColours[i]);
		  	arrayOfPlaceholders[i].getElementsByClassName('photoTemplate')[0].style.backgroundColor = pSBC( change, pSBC( -.8, spotifyColours[i]));
			arrayOfPlaceholders[i].style.backgroundColor = pSBC(change, "#242526");
		}

	    setTimeout(breatheColour, 20);
	} //changes the colours of the templates to add a loading animation

	const container = document.getElementsByClassName('body')[0];
    var spotifyColours = [];
	var	arrayOfPlaceholders = [];
	var arrayOfPosts = [];
	var expandedPosts = [];
	var change = 0.01;
	var pos = 1;

	addPost();
	addPost();
	breatheColour();

	</script> <!-- create placeholder posts with animations -->
	<script>

    setTimeout(replacePosts, 2000);
    function replacePosts () {
    	//container.removeChild(container.childNodes[0]);
    	container.replaceChild(loadPost(),container.childNodes[0])
    	container.replaceChild(loadPost(),container.childNodes[1])
    }
	</script> <!-- 	make a function that can replace a post template with an actual post. -->
	<script>

	window.addEventListener('resize', onResizeOrLoad);
	window.addEventListener('load', onResizeOrLoad);

	function clickOnText() {
		let elmnt = this.getElementsByClassName('text')[0];
		let i = arrayOfPosts.indexOf(this);
		console.log(expandedPosts);
	    if (elmnt.scrollHeight > 250) {
		    expandedPosts[i] = !expandedPosts[i];
		    if (expandedPosts[i]) {
		      elmnt.style.maxHeight = 'none';
		      elmnt.style['-webkit-mask-image'] = 'none'; 
	    	} else {
	      		elmnt.style.maxHeight = '250px';
	    		elmnt.style['-webkit-mask-image'] = 'linear-gradient(180deg, #000 60%, transparent)'; 
	    	}
	 	}
	} //toggle between expanded & not expanded text boxed
	function onResizeOrLoad(e) {
	    for (var i = 0; i < arrayOfPosts.length; i++) {
	    	currentTextbox = arrayOfPosts[i].getElementsByClassName('text')[0]
			if (currentTextbox.scrollHeight > 250 && expandedPosts[i] == false) {
			    currentTextbox.style.cursor = 'pointer';
			    currentTextbox.style['-webkit-mask-image'] = 'linear-gradient(180deg, #000 60%, transparent)'; 

			} else if (currentTextbox.scrollHeight > 250) {
			    currentTextbox.style.cursor = 'pointer';
			    currentTextbox.style['-webkit-mask-image'] = 'none'; 

			} else {
			    currentTextbox.style.cursor = 'default';
			    currentTextbox.style.maxHeight = '250px';
			    currentTextbox.style['-webkit-mask-image'] = 'none'; 

			    expandedPosts[i] = false;
			}
		}
    }; //checks if the text gets smaller/larger than 250px when resized, so toggle for textboxes can be disabled/enabled

	</script>	<!-- code to make the toggles on text work -->

</body>
</html>